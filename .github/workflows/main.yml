# 文件路径: .github/workflows/renew.yml
name: GreatHost Auto-Renewal Script

on:
  # 定时触发：已按您的要求修改
  schedule:
    # 每天中午12点 (北京时间) 运行
    # 对应UTC时间为 4:00
    - cron: '0 4 * * *'
    
    # 每天下午6点 (北京时间) 运行
    # 对应UTC时间为 10:00
    - cron: '0 10 * * *'

  # 手动触发：保留此项，方便您在 GitHub Actions 页面随时手动测试
  workflow_dispatch:

jobs:
  renew-contract:
    runs-on: ubuntu-latest

    steps:
      # 检出代码
      - name: Checkout repository
        uses: actions/checkout@v4

      # 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 安装依赖库
      - name: Install dependencies
        run: pip install selenium

      # 安装浏览器
      - name: Setup Chrome
        uses: browser-actions/setup-chrome@v1
      
      # 运行您的Python脚本（文件名已按要求修改为 greathost.py）
      - name: Run renewal script
        run: python greathost.py
        env:
          GREATHOS_USERNAME: ${{ secrets.GREATHOS_USERNAME }}
          GREATHOS_PASSWORD: ${{ secrets.GREATHOS_PASSWORD }}
          CONTRACT_IDENTIFIER: ${{ secrets.CONTRACT_IDENTIFIER }}

      # 如果脚本失败，上传截图用于调试
      - name: Upload screenshot on failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: error-screenshot
          path: error_screenshot.png
