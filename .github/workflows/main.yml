name: Greathost Renew

on:
  schedule:
    # GitHub Actions 使用 UTC，下面这行表示北京时间 12:00 和 18:00（UTC+8 -> UTC 04:00/10:00）
    - cron: "0 4,10 * * *"
  workflow_dispatch:

permissions:
  contents: write  # 如果需要提交 README.md 变更

jobs:
  renew:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    concurrency:
      group: greathost-renew
      cancel-in-progress: true

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Playwright
        run: |
          pip install playwright==1.48.0
          python -m playwright install --with-deps chromium

      - name: Run renew script
        env:
          GREATHOST_URL: https://greathost.es
          GREATHOST_SERVER_URLS: ${{ secrets.GREATHOST_SERVER_URLS }}  # 或直接写死
          GREATHOST_REMEMBER_COOKIE_NAME: remember_web_xxx
          GREATHOST_REMEMBER_COOKIE_VALUE: ${{ secrets.GREATHOST_REMEMBER_COOKIE_VALUE }}
          GREATHOST_EMAIL: ${{ secrets.GREATHOST_EMAIL }}
          GREATHOST_PASSWORD: ${{ secrets.GREATHOST_PASSWORD }}
          HEADLESS: "true"
        run: |
          python your_script.py

      # 可选：提交 README.md 变更（脚本会生成报告）
      - name: Commit README changes
        if: always()
        run: |
          if [[ -n "$(git status --porcelain)" ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add README.md screens || true
            git commit -m "chore: update renew report [skip ci]"
            git push
          fi
